extends ../layouts/application.pug

block header
    div.text-center
        = t('views.task.table')

block content
    - const getFilterValue = (name) => _.get(filters, name, 'null')
    .container.bg-light.p-5.pt-4.rounded-lg
        h4.text-center= t('views.task.filter.filter')
        form.row.gy-2.gx-3.align-items-end(action=route('tasks'), method='GET')
            .col-auto
                label(for='users')= t('views.task.executor')
                select#users.form-select(name='executorId')
                    option(value='null', selected= getFilterValue('executorId') === 'null')
                    for user in users
                        option(value=user.id, selected= getFilterValue('executorId') == user.id)= user.email
            .col-auto
                label(for='users')= t('views.task.labels')
                select#labels.form-select(name='labelId')
                    option(value='null', selected= getFilterValue('labelId') === 'null')
                    for label in labels
                      option(value=label.id, selected= getFilterValue('labelId') == label.id)= label.name
            .col-auto
                label(for='statuses')= t('views.task.status')
                select#statuses.form-select(name="statusId")
                    option(value='null', selected= getFilterValue('statusId') === 'null')
                    for taskStatus in taskStatuses
                      option(value=taskStatus.id, selected= getFilterValue('statusId') == taskStatus.id)= taskStatus.name
            .col-auto.mt-3
                .form-check
                    input#currentUser.form-check-input(
                        type='checkbox',
                        name='creatorId',
                        value= currUserId,
                        checked= getFilterValue('creatorId') == currUserId
                    )
                    label.form-check-label(for='currentUser')= t('views.task.filter.toMe')
            .col-auto
                button.btn.btn-primary.mr-3(type='submit')= t('buttons.submit')

    a.btn.btn-primary.float-right.mt-3(href=route('tasks/new'))= t('buttons.new')
    table.table.table-striped
        thead
            tr
                th= t('views.task.name')
                th= t('views.task.labels')
                th= t('views.task.status')
                th= t('views.task.creator')
                th= t('views.task.executor')
        tbody
          each task in tasks
              tr
                  td
                    a(href=route('tasks/info', { id: task.id }))= task.name
                  td
                    for label in task.labels
                      .badge.bg-secondary.m-1= label.name
                  td= task.status && task.status.name
                  td= task.creator && task.creator.email
                  td= task.executor && task.executor.email || t('views.task.nonExecutor')
